<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết Khuyến mãi - Pet Shop Vendor</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/vendor/vendor-dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/vendor/promotions/promotion-view.css}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Vendor -->
            <div th:replace="~{vendor/fragments/navbar :: navbar}"></div>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Header Vendor -->
                <div th:replace="~{vendor/fragments/header :: header}"></div>

                <div class="stats-container">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h1 class="page-title">
                                    <i class="fas fa-eye me-2"></i>
                                    Chi tiết Khuyến mãi
                                </h1>
                                <p class="page-subtitle">Xem thông tin chi tiết về khuyến mãi của bạn</p>
                            </div>
                            <div class="action-buttons">
                                <a th:href="@{/vendor/promotions}" class="btn btn-back">
                                    <i class="fas fa-arrow-left me-2"></i>Quay lại
                                </a>
                                <a th:href="@{/vendor/promotions/edit/{id}(id=${khuyenMai.maKhuyenMai})}" class="btn btn-edit">
                                    <i class="fas fa-edit me-2"></i>Cập nhật thông tin
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Promotion Summary Card -->
                    <div class="promotion-summary-card">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="promotion-icon">
                                    <i class="fas fa-tag"></i>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h3 class="promotion-code" th:text="${khuyenMai.maGiamGia}">MÃGIAMGIA</h3>
                                <div class="promotion-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-percentage me-1"></i>
                                        Giảm <strong th:text="${khuyenMai.discount} + '%'">10%</strong>
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-calendar me-1"></i>
                                        <span th:text="${#temporals.format(khuyenMai.ngayBatDau, 'dd/MM/yyyy')} + ' - ' + ${#temporals.format(khuyenMai.ngayKetThuc, 'dd/MM/yyyy')}">
                                            01/01/2024 - 31/01/2024
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="status-display">
                                    <div class="status-badge" 
                                         th:classappend="${khuyenMai.trangThaiHienTai == 'Đang kích hoạt'} ? 'status-active' : 
                                                        (${khuyenMai.trangThaiHienTai == 'Sắp diễn ra'} ? 'status-upcoming' : 
                                                        (${khuyenMai.trangThaiHienTai == 'Đã hết hạn'} ? 'status-expired' : 'status-inactive'))">
                                        <i class="fas me-1" 
                                           th:classappend="${khuyenMai.trangThaiHienTai == 'Đang kích hoạt'} ? 'fa-check-circle' : 
                                                          (${khuyenMai.trangThaiHienTai == 'Sắp diễn ra'} ? 'fa-clock' : 'fa-times-circle')"></i>
                                        <span th:text="${khuyenMai.trangThaiHienTai}">Trạng thái</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Promotion Details -->
                    <div class="row">
                        <!-- Basic Information -->
                        <div class="col-lg-6">
                            <div class="detail-card">
                                <div class="detail-card-header">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Thông tin cơ bản
                                </div>
                                <div class="detail-card-body">
                                    <div class="detail-item">
                                        <label class="detail-label">Mã khuyến mãi:</label>
                                        <span class="detail-value" th:text="${khuyenMai.maKhuyenMai}">KM001</span>
                                    </div>
                                    <div class="detail-item">
                                        <label class="detail-label">Mã giảm giá:</label>
                                        <span class="detail-value promotion-code-text" th:text="${khuyenMai.maGiamGia}">SUMMER2024</span>
                                    </div>
                                    <div class="detail-item">
                                        <label class="detail-label">Tỷ lệ giảm giá:</label>
                                        <span class="detail-value discount-text" th:text="${khuyenMai.discount} + '%'">10%</span>
                                    </div>
                                    <div class="detail-item">
                                        <label class="detail-label">Trạng thái kích hoạt:</label>
                                        <span class="detail-value">
                                            <span class="status-indicator" 
                                                  th:classappend="${khuyenMai.trangThai} ? 'status-on' : 'status-off'"
                                                  th:text="${khuyenMai.trangThai} ? 'Đang áp dụng' : 'Ngừng áp dụng'">
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Time Information -->
                        <div class="col-lg-6">
                            <div class="detail-card">
                                <div class="detail-card-header">
                                    <i class="fas fa-calendar-alt me-2"></i>
                                    Thông tin thời gian
                                </div>
                                <div class="detail-card-body">
                                    <div class="detail-item">
                                        <label class="detail-label">Ngày bắt đầu:</label>
                                        <span class="detail-value" th:text="${#temporals.format(khuyenMai.ngayBatDau, 'dd/MM/yyyy')}">01/01/2024</span>
                                    </div>
                                    <div class="detail-item">
                                        <label class="detail-label">Ngày kết thúc:</label>
                                        <span class="detail-value" th:text="${#temporals.format(khuyenMai.ngayKetThuc, 'dd/MM/yyyy')}">31/01/2024</span>
                                    </div>
                                    <div class="detail-item">
                                        <label class="detail-label">Thời hạn hiệu lực:</label>
                                        <span class="detail-value">
                                            <span th:if="${khuyenMai.trangThai and khuyenMai.ngayKetThuc.isAfter(T(java.time.LocalDate).now())}">
                                                <i class="fas fa-check-circle text-success me-1"></i>
                                                Còn hiệu lực
                                            </span>
                                            <span th:if="${khuyenMai.ngayKetThuc.isBefore(T(java.time.LocalDate).now())}">
                                                <i class="fas fa-exclamation-triangle text-warning me-1"></i>
                                                Đã hết hạn
                                            </span>
                                            <span th:if="${khuyenMai.ngayBatDau.isAfter(T(java.time.LocalDate).now())}">
                                                <i class="fas fa-clock text-info me-1"></i>
                                                Sắp diễn ra
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quantity Information -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="detail-card">
                                <div class="detail-card-header">
                                    <i class="fas fa-chart-bar me-2"></i>
                                    Thống kê số lượng
                                </div>
                                <div class="detail-card-body">
                                    <div class="row text-center">
                                        <div class="col-md-4 mb-3">
                                            <div class="quantity-card total">
                                                <div class="quantity-icon">
                                                    <i class="fas fa-boxes"></i>
                                                </div>
                                                <div class="quantity-number" th:text="${khuyenMai.soLuongMaGiamGia}">100</div>
                                                <div class="quantity-label">Tổng số mã</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="quantity-card used">
                                                <div class="quantity-icon">
                                                    <i class="fas fa-shopping-cart"></i>
                                                </div>
                                                <div class="quantity-number" th:text="${khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0}">25</div>
                                                <div class="quantity-label">Đã sử dụng</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="quantity-card remaining">
                                                <div class="quantity-icon">
                                                    <i class="fas fa-box-open"></i>
                                                </div>
                                                <div class="quantity-number" 
                                                     th:text="${khuyenMai.soLuongMaGiamGia - (khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0)}">
                                                    75
                                                </div>
                                                <div class="quantity-label">Còn lại</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Usage Progress -->
                                    <div class="usage-progress-section">
                                        <div class="progress-info">
                                            <span class="progress-label">Tỉ lệ sử dụng</span>
                                            <span class="progress-percentage">
                                                <span th:text="${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) > 0 ? 
                                                    ((khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia) : 0}">
                                                    25
                                                </span>%
                                            </span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar" 
                                                 role="progressbar" 
                                                 th:attr="style='width: ' + ${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) > 0 ? 
                                                     ((khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia) : 0} + '%;'"
                                                 th:classappend="${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia >= 80} ? 
                                                     'bg-warning' : 'bg-success'">
                                            </div>
                                        </div>
                                        <div class="progress-note">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                <span th:if="${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia >= 80}">
                                                    Sắp hết mã khuyến mãi, cần bổ sung thêm
                                                </span>
                                                <span th:if="${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia < 80 and 
                                                              (khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia >= 50}">
                                                    Mã khuyến mãi đang được sử dụng tốt
                                                </span>
                                                <span th:if="${(khuyenMai.soLuongDaSuDung != null ? khuyenMai.soLuongDaSuDung : 0) * 100 / khuyenMai.soLuongMaGiamGia < 50}">
                                                    Mã khuyến mãi còn nhiều
                                                </span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Action Buttons -->
                    <div class="action-section mt-4">
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-center gap-3">
                                    <a th:href="@{/vendor/promotions}" class="btn btn-secondary btn-lg">
                                        <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
                                    </a>
                                    <a th:href="@{/vendor/promotions/edit/{id}(id=${khuyenMai.maKhuyenMai})}" class="btn btn-primary btn-lg">
                                        <i class="fas fa-edit me-2"></i>Cập nhật thông tin
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/vendor/vendor-dashboard.js}"></script>
</body>
</html>