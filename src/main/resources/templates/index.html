<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Shop - Trang chủ thú cưng</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/web/header.css}">
    <link rel="stylesheet" th:href="@{/css/web/content.css}">
    <link rel="stylesheet" th:href="@{/css/web/chat-modal.css}">
    <link rel="stylesheet" th:href="@{/css/web/footer.css}">
</head>
<body>
    <!-- Include Header Fragment -->
    <div th:replace="~{web/layout/header :: header}"></div>
    
    <!-- Hero Banner -->
    <section class="hero-banner">
        <div class="container">
            <div class="hero-content" data-aos="fade-up">
                <div class="hero-text">
                    <h1>Chào mừng đến với<br>Pet Shop</h1>
                    <p>Nơi cung cấp thú cưng và phụ kiện chất lượng cao nhất.<br>Chăm sóc thú cưng của bạn như chính gia đình chúng tôi.</p>
                    <a href="#products" class="hero-btn">Khám phá ngay</a>
                </div>
                <div class="hero-image">
                    <img src="https://images.unsplash.com/photo-1450778869180-41d0601e046e?w=800" alt="Pet Banner">
                </div>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
                <h2>Danh mục sản phẩm</h2>
                <p>Khám phá các loại thú cưng và phụ kiện đa dạng</p>
            </div>
            <div class="category-grid">
                <a th:href="@{/category/cho-canh}" style="text-decoration: none;">
                    <div class="category-card" data-aos="fade-up" data-aos-delay="100">
                        <i class="fa-solid fa-dog"></i>
                        <h3>Chó cảnh</h3>
                        <p>Các giống chó cảnh đáng yêu và thân thiện</p>
                    </div>
                </a>
                <a th:href="@{/category/meo-canh}" style="text-decoration: none;">
                    <div class="category-card" data-aos="fade-up" data-aos-delay="200">
                        <i class="fa-solid fa-cat"></i>
                        <h3>Mèo cảnh</h3>
                        <p>Mèo cảnh đủ màu sắc và giống loài</p>
                    </div>
                </a>
                <a th:href="@{/category/phu-kien}" style="text-decoration: none;">
                    <div class="category-card" data-aos="fade-up" data-aos-delay="300">
                        <i class="fa-solid fa-bone"></i>
                        <h3>Phụ kiện</h3>
                        <p>Đồ chơi, thức ăn và các phụ kiện cần thiết</p>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section" id="products">
	    <div class="container" style="background-color: #f6f9fc;">
	        <div class="section-title" data-aos="fade-up">
	            <h2>Sản phẩm nổi bật</h2>
	            <p>Những sản phẩm được yêu thích nhất</p>
	        </div>
	        <div class="product-grid">
	            <!-- Chó Cảnh Products -->
	            <div th:if="${not #lists.isEmpty(sanPhams_1)}" th:each="product : ${sanPhams_1}" class="product-card" data-aos="fade-up" data-aos-delay="100">
	                <div class="product-image-container">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
	                    </a>
	                    <!-- Thêm phần lượt thích với icon trái tim -->
	                    <div class="product-like">
	                        <i class="fa-solid fa-heart like-icon"></i>
	                        <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
	                    </div>
	                </div>
	                <div class="product-info">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <h4 th:text="${product.TenSanPham}"></h4>
	                    </a>
	                    <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
	                    <div class="product-stats">
	                        <div class="rating">
	                            <span th:each="i : ${#numbers.sequence(1, 5)}"
	                                  class="fa fa-star"
	                                  th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
	                                  <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
	                        </div>
	                        <div class="product-sold">
	                            <span class="sold-label">Đã bán:</span>
	                            <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
	                        </div>
	                    </div>
	                    <button class="add-to-cart-btn">
	                        <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
	                    </button>
	                </div>
	            </div>
	
	            <!-- Mèo Cảnh Products -->
	            <div th:if="${not #lists.isEmpty(sanPhams_2)}" th:each="product : ${sanPhams_2}" class="product-card" data-aos="fade-up" data-aos-delay="200">
	                <div class="product-image-container">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
	                    </a>
	                    <!-- Thêm phần lượt thích với icon trái tim -->
	                    <div class="product-like">
	                        <i class="fa-solid fa-heart like-icon"></i>
	                        <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
	                    </div>
	                </div>
	                <div class="product-info">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <h4 th:text="${product.TenSanPham}"></h4>
	                    </a>
	                    <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
	                    <div class="product-stats">
	                        <div class="rating">
	                            <span th:each="i : ${#numbers.sequence(1, 5)}"
	                                  class="fa fa-star"
	                                  th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
	                                  <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
	                        </div>
	                        <div class="product-sold">
	                            <span class="sold-label">Đã bán:</span>
	                            <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
	                        </div>
	                    </div>
	                    <button class="add-to-cart-btn">
	                        <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
	                    </button>
	                </div>
	            </div>
	
	            <!-- Phụ Kiện Products -->
	            <div th:if="${not #lists.isEmpty(sanPhams_3)}" th:each="product : ${sanPhams_3}" class="product-card" data-aos="fade-up" data-aos-delay="300">
	                <div class="product-image-container">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
	                    </a>
	                    <!-- Thêm phần lượt thích với icon trái tim -->
	                    <div class="product-like">
	                        <i class="fa-solid fa-heart like-icon"></i>
	                        <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
	                    </div>
	                </div>
	                <div class="product-info">
	                    <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
	                        <h4 th:text="${product.TenSanPham}"></h4>
	                    </a>
	                    <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
	                    <div class="product-stats">
	                        <div class="rating">
	                            <span th:each="i : ${#numbers.sequence(1, 5)}"
	                                  class="fa fa-star"
	                                  th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
	                                  <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
	                        </div>
	                        <div class="product-sold">
	                            <span class="sold-label">Đã bán:</span>
	                            <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
	                        </div>
	                    </div>
	                    <button class="add-to-cart-btn">
	                        <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
	                    </button>
	                </div>
	            </div>
	        </div>
	    </div>
	</section>

    <!-- Dog Section -->
    <section class="category-products-section dog-section">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <div class="section-header-left">
                    <i class="fa-solid fa-dog"></i>
                    <h2>Chó Cảnh</h2>
                </div>
                <a th:href="@{/category/cho-canh}" class="view-all-btn">
                    Xem tất cả <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
            <div class="product-grid">
                <div th:if="${not #lists.isEmpty(sanPhams_1)}" th:each="product : ${sanPhams_1}" class="product-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="product-image-container">
				        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
				            <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
				        </a>
				        <div class="product-like">
				            <i class="fa-solid fa-heart like-icon"></i>
				            <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
				        </div>
				    </div>
                    <div class="product-info">
                        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
                            <h4 th:text="${product.TenSanPham}"></h4>
                        </a>
                        <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
                        <div class="product-stats">
                            <div class="rating">
                                <span th:each="i : ${#numbers.sequence(1, 5)}"
                                      class="fa fa-star"
                                      th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
                                      <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
                            </div>
                            <div class="product-sold">
                                <span class="sold-label">Đã bán:</span>
                                <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
                            </div>
                        </div>
                        <button class="add-to-cart-btn">
                            <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
                        </button>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(sanPhams_1)}" class="no-data-message">
                    Không có dữ liệu cho danh mục Chó Cảnh.
                </div>
            </div>
        </div>
    </section>

    <!-- Cat Section -->
    <section class="category-products-section cat-section">
        <div class="container" style="background-color: #f6f9fc;">
            <div class="section-header" data-aos="fade-up">
                <div class="section-header-left">
                    <i class="fa-solid fa-cat"></i>
                    <h2>Mèo Cảnh</h2>
                </div>
                <a th:href="@{/category/meo-canh}" class="view-all-btn">
                    Xem tất cả <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
            <div class="product-grid">
                <div th:if="${not #lists.isEmpty(sanPhams_2)}" th:each="product : ${sanPhams_2}" class="product-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="product-image-container">
				        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
				            <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
				        </a>
				        <div class="product-like">
				            <i class="fa-solid fa-heart like-icon"></i>
				            <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
				        </div>
				    </div>
                    <div class="product-info">
                        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
                            <h4 th:text="${product.TenSanPham}"></h4>
                        </a>
                        <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
                        <div class="product-stats">
                            <div class="rating">
                                <span th:each="i : ${#numbers.sequence(1, 5)}"
                                      class="fa fa-star"
                                      th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
                                      <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
                            </div>
                            <div class="product-sold">
                                <span class="sold-label">Đã bán:</span>
                                <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
                            </div>
                        </div>
                        <button class="add-to-cart-btn">
                            <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
                        </button>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(sanPhams_2)}" class="no-data-message">
                    Không có dữ liệu cho danh mục Mèo Cảnh.
                </div>
            </div>
        </div>
    </section>

    <!-- Accessories Section -->
    <section class="category-products-section accessories-section">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <div class="section-header-left">
                    <i class="fa-solid fa-bone"></i>
                    <h2>Phụ Kiện</h2>
                </div>
                <a th:href="@{/category/phu-kien}" class="view-all-btn">
                    Xem tất cả <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
            <div class="product-grid">
                <div th:if="${not #lists.isEmpty(sanPhams_3)}" th:each="product : ${sanPhams_3}" class="product-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="product-image-container">
				        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
				            <img th:src="${product.HinhAnh}" th:alt="${product.TenSanPham}" class="product-image">
				        </a>
				        <div class="product-like">
				            <i class="fa-solid fa-heart like-icon"></i>
				            <span class="like-count" th:text="${product.LuotThich} ?: 0">0</span>
				        </div>
				    </div>
                    <div class="product-info">
                        <a th:href="@{/view/{MaSanPham}(MaSanPham=${product.MaSanPham})}">
                            <h4 th:text="${product.TenSanPham}"></h4>
                        </a>
                        <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}"></div>
                        <div class="product-stats">
                            <div class="rating">
                                <span th:each="i : ${#numbers.sequence(1, 5)}"
                                      class="fa fa-star"
                                      th:classappend="${i <= product.SaoDanhGia} ? ' filled' : ''"></span>
                                      <span class="rating-score" th:text="'(' + ${product.SaoDanhGia} + ')'"></span>
                            </div>
                            <div class="product-sold">
                                <span class="sold-label">Đã bán:</span>
                                <span class="sold-count" th:text="${product.SoLuongDaBan}"></span>
                            </div>
                        </div>
                        <button class="add-to-cart-btn">
                            <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
                        </button>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(sanPhams_3)}" class="no-data-message">
                    Không có dữ liệu cho danh mục Phụ Kiện.
                </div>
            </div>
        </div>
    </section>
    
    <!-- Section: Cửa Hàng -->
    <section class="store-section">
        <div class="container" >
            <div class="section-title" data-aos="fade-up">
                <h2>Các cửa hàng của chúng tôi</h2>
                <p>Khám phá các cửa hàng thú cưng tại các thành phố khác nhau</p>
            </div>
            <div class="store-grid">
                <div th:each="cuaHang : ${cuaHangs}" 
                     class="store-card" 
                     data-aos="fade-up" 
                     th:attr="data-aos-delay=${cuaHangStat.count * 100}">
                    <a th:href="@{/store/{MaCuaHang}(MaCuaHang=${cuaHang.MaCuaHang})}">
                        <img th:src="${cuaHang.hinhAnh != null ? cuaHang.hinhAnh : '/images/store-default.jpg'}" 
					     th:alt="${cuaHang.tenCuaHang}" 
					     class="store-image">
                    </a>
                    <div class="store-info">
                        <a th:href="@{/store/{MaCuaHang}(MaCuaHang=${cuaHang.MaCuaHang})}">
                            <h4 th:text="${cuaHang.TenCuaHang}">Cửa hàng Thú Cưng Hà Nội</h4>
                        </a>
                        <p th:text="${cuaHang.MoTa}">Chuyên cung cấp các loại thú cưng và phụ kiện chất lượng tại Hà Nội</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="container">
            <div class="features-grid">
                <div class="feature-item" data-aos="fade-up" data-aos-delay="100">
                    <i class="fa-solid fa-truck-fast"></i>
                    <h4>Giao hàng nhanh</h4>
                    <p>Miễn phí vận chuyển cho đơn hàng trên 500k</p>
                </div>
                <div class="feature-item" data-aos="fade-up" data-aos-delay="200">
                    <i class="fa-solid fa-shield-halved"></i>
                    <h4>Bảo hành chất lượng</h4>
                    <p>Cam kết sức khỏe thú cưng 100%</p>
                </div>
                <div class="feature-item" data-aos="fade-up" data-aos-delay="300">
                    <i class="fa-solid fa-headset"></i>
                    <h4>Hỗ trợ 24/7</h4>
                    <p>Tư vấn chăm sóc thú cưng mọi lúc</p>
                </div>
                <div class="feature-item" data-aos="fade-up" data-aos-delay="400">
                    <i class="fa-solid fa-rotate-left"></i>
                    <h4>Đổi trả dễ dàng</h4>
                    <p>Đổi trả trong vòng 7 ngày</p>
                </div>
            </div>
        </div>
    </section>
    <button id="scrollToTopBtn" class="scroll-to-top-btn hidden" title="Lên đầu trang">
        <i class="fa-solid fa-angles-up"></i>
    </button>
    <div th:replace="~{web/layout/footer :: footer}"></div>
	
	<!-- Chat Modal -->
	<div id="chatModal" class="chat-modal">
	    <div class="chat-modal-content">
	        <!-- Chat Header -->
	        <div class="chat-modal-header">
	            <div class="chat-header-left">
	                <i class="fa-solid fa-comments"></i>
	                <h3>Tin nhắn</h3>
	            </div>
	            <div class="chat-header-actions">
	                <button class="chat-btn-minimize" title="Thu nhỏ">
	                    <i class="fa-solid fa-window-minimize"></i>
	                </button>
	                <button class="chat-btn-close" title="Đóng">
	                    <i class="fa-solid fa-times"></i>
	                </button>
	            </div>
	        </div>
	
	        <!-- Chat Body -->
	        <div class="chat-modal-body">
	            <!-- Left Sidebar - Danh sách cửa hàng -->
	            <div class="chat-sidebar">
	                <div class="chat-search">
	                    <i class="fa-solid fa-search"></i>
	                    <input type="text" id="chatStoreSearch" placeholder="Tìm kiếm cửa hàng...">
	                </div>
	                
	                <div class="store-list" id="storeList">
	                    <!-- Danh sách cửa hàng sẽ được load bằng JavaScript -->
	                    <div class="loading-stores">
	                        <i class="fa-solid fa-spinner fa-spin"></i>
	                        <p>Đang tải cửa hàng...</p>
	                    </div>
	                </div>
	            </div>
	
	            <!-- Right Content - Chat Area -->
	            <div class="chat-main">
	                <!-- No Store Selected -->
	                <div class="no-store-selected" id="noStoreSelected">
	                    <i class="fa-solid fa-store"></i>
	                    <h4>Chọn một cửa hàng</h4>
	                    <p>Chọn cửa hàng từ danh sách bên trái để bắt đầu chat</p>
	                </div>
	
	                <!-- Chat Active Area -->
	                <div class="chat-active-area" id="chatActiveArea" style="display: none;">
	                    <!-- Store Info Header -->
	                    <div class="store-chat-header">
	                        <div class="store-chat-info">
	                            <img id="currentStoreAvatar" src="/images/default-store.png" alt="Store" class="store-chat-avatar">
	                            <div class="store-chat-details">
	                                <h4 id="currentStoreName">Cửa hàng</h4>
	                                <span class="online-status">
	                                    <i class="fa-solid fa-circle"></i> Đang hoạt động
	                                </span>
	                            </div>
	                        </div>
	                        <div class="store-chat-actions">
	                            <button class="btn-store-info" title="Thông tin cửa hàng">
	                                <i class="fa-solid fa-info-circle"></i>
	                            </button>
	                        </div>
	                    </div>
	
	                    <!-- Chat Messages -->
	                    <div class="chat-messages-container">
	                        <div class="chat-messages" id="chatMessages">
	                            <div class="welcome-message">
	                                <i class="fa-solid fa-comments"></i>
	                                <h4>Bắt đầu cuộc trò chuyện</h4>
	                                <p>Chào bạn! Chúng tôi có thể giúp gì cho bạn?</p>
	                            </div>
	                        </div>
	                    </div>
	
	                    <!-- Typing Indicator -->
	                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
	                        <span id="typingStoreName"></span> đang gõ
	                        <span class="typing-dots">
	                            <span>.</span><span>.</span><span>.</span>
	                        </span>
	                    </div>
	
	                    <!-- Chat Input -->
	                    <div class="chat-input-container">
	                        <button class="btn-attachment" title="Đính kèm file">
	                            <i class="fa-solid fa-paperclip"></i>
	                            <input type="file" id="chatFileInput" accept="image/*,video/*,application/pdf" style="display: none;">
	                        </button>
	                        
	                        <div class="input-wrapper">
	                            <textarea id="chatMessageInput" 
	                                      placeholder="Nhập tin nhắn của bạn..."
	                                      rows="1"></textarea>
	                        </div>
	                        
	                        <button class="btn-send" id="chatSendButton">
	                            <i class="fa-solid fa-paper-plane"></i>
	                        </button>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- Chat Toggle Button -->
	<button id="chatToggleBtn" class="chat-toggle-btn">
	    <i class="fa-solid fa-comments"></i>
	    <span class="unread-badge" id="chatUnreadBadge" style="display: none;">0</span>
	</button>
	
	<!-- Minimized Chat -->
	<div id="minimizedChat" class="minimized-chat" style="display: none;">
	    <div class="minimized-chat-header">
	        <span id="minimizedStoreName">Tin nhắn</span>
	        <div class="minimized-actions">
	            <button class="btn-restore-chat" title="Mở rộng">
	                <i class="fa-solid fa-window-maximize"></i>
	            </button>
	            <button class="btn-close-minimized" title="Đóng">
	                <i class="fa-solid fa-times"></i>
	            </button>
	        </div>
	    </div>
	    <div class="minimized-unread" id="minimizedUnread" style="display: none;">
	        <span id="minimizedUnreadCount">0</span>
	    </div>
	</div>
	
	<!-- Hidden data for JavaScript -->
    <input type="hidden" id="currentUserId" 
       th:value="${nguoiDung?.maNguoiDung} ?: 0">

    <!-- Products Data for Search -->
    <script id="products-data" type="application/json" th:inline="javascript">
        /*[[${productsJson}]]*/
    </script>
    
    <!-- AOS Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init({
            duration: 800,
            once: true
        });
    </script>
    
    <!-- WebSocket Libraries for Chat -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    
    <!-- Main JavaScript -->
    <script th:src="@{/js/web/header.js}"></script>
    <script th:src="@{/js/web/chat-modal.js}"></script>
    <!-- Cart Functionality Script -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		    // ======================================================
		    // LOGIC 1: THÊM VÀO GIỎ HÀNG (GIỮ NGUYÊN)
		    // ======================================================
		    
		    document.addEventListener('click', function(e) {
		        if (e.target.closest('.add-to-cart-btn')) {
		            e.preventDefault();
		            e.stopPropagation();
		            
		            const button = e.target.closest('.add-to-cart-btn');
		            const productCard = button.closest('.product-card');
		            const productLink = productCard.querySelector('a[href*="/view/"]');
		            
		            if (productLink) {
		                const href = productLink.getAttribute('href');
		                const maSanPham = href.split('/').pop();
		                
		                // Disable button tạm thời
		                button.disabled = true;
		                const originalHTML = button.innerHTML;
		                button.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Đang thêm...';
		                
		                if (typeof addToCart === 'function') {
		                    addToCart(maSanPham, 1);
		                } else {
		                    const token = localStorage.getItem('jwtToken');
		                    if (!token) {
		                        window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
		                    }
		                }
		                
		                setTimeout(() => {
		                    button.disabled = false;
		                    button.innerHTML = originalHTML;
		                }, 1000);
		            }
		        }
		    });
		    
		    // ======================================================
		    // LOGIC 2: SCROLL TO TOP (FIXED ĐƠN GIẢN)
		    // ======================================================
		    
		    const scrollToTopBtn = document.getElementById('scrollToTopBtn');
		    
		    if (scrollToTopBtn) {
		        // Đảm bảo trạng thái ban đầu
		        scrollToTopBtn.style.display = 'none';
	
		        function toggleScrollButton() {
		            // Nút hiển thị khi cuộn xuống 300px
		            const scrolledDownEnough = (window.scrollY || document.documentElement.scrollTop) > 300;
	
		            if (scrolledDownEnough) {
		                // Chỉ thêm class và đổi display nếu nút đang ẩn
		                if (scrollToTopBtn.style.display === 'none') {
		                    scrollToTopBtn.style.display = 'block';
		                }
	
		                if (scrollToTopBtn.classList.contains('hidden')) {
		                    scrollToTopBtn.classList.remove('hidden');
		                    scrollToTopBtn.classList.add('visible');
		                }
		                
		                // Loại bỏ mọi class absolute để đảm bảo nó luôn fixed
		                scrollToTopBtn.classList.remove('absolute-bottom');
		                scrollToTopBtn.style.top = 'auto'; 
		                scrollToTopBtn.style.bottom = '30px';
		                
		            } else {
		                // Kích hoạt animation ẩn
		                if (scrollToTopBtn.classList.contains('visible')) {
		                    scrollToTopBtn.classList.remove('visible');
		                    scrollToTopBtn.classList.add('hidden');
		                }
		                
		                // Ẩn hoàn toàn sau khi animation kết thúc (0.4s)
		                setTimeout(() => {
		                    if (scrollToTopBtn.classList.contains('hidden')) {
		                        scrollToTopBtn.style.display = 'none';
		                    }
		                }, 400); 
		            }
		        }
		        
		        // Sự kiện cuộn và tải trang
		        window.addEventListener('scroll', toggleScrollButton);
		        
		        // Rất quan trọng: Kiểm tra vị trí ngay khi trang tải xong
		        window.addEventListener('load', toggleScrollButton);
	
		        // Sự kiện Click
		        scrollToTopBtn.addEventListener('click', function() {
		            window.scrollTo({
		                top: 0,
		                behavior: 'smooth'
		            });
		        });
		    }
		});
	</script>
</body>
</html>